# 🖼️ 이미지 직접 업로드 가이드

## ✅ **구현 완료!**

이미지를 직접 업로드할 수 있는 기능이 추가되었습니다!

---

## 🎯 **사용 방법**

### **1. 백오피스 접속**
```
https://dms-guide.figma.site/admin
```

### **2. 페이지 편집 탭 클릭**

### **3. 편집할 페이지 선택**
예: "기관 대표 관리자 회원가입"

### **4. Step 관리 탭에서 이미지 업로드**

---

## 📤 **이미지 업로드 방법 (2가지)**

### **방법 1: 드래그 앤 드롭** 🖱️

```
1. 컴퓨터에서 이미지 파일 선택
2. 업로드 영역으로 드래그
3. 놓기 (Drop)
4. 자동 업로드 → Supabase Storage 저장
5. 업로드 완료 → URL 자동 적용
```

### **방법 2: 파일 선택 버튼** 📁

```
1. "파일 선택" 버튼 클릭
2. 이미지 파일 선택
3. 자동 업로드 → Supabase Storage 저장
4. 업로드 완료 → URL 자동 적용
```

### **방법 3: URL 직접 입력** 🔗

```
여전히 URL 직접 입력도 가능합니다:
- Unsplash URL
- Figma Assets URL
- 외부 이미지 URL
```

---

## 🎨 **UI 구성**

### **이미지 업로드 영역:**

```
┌─────────────────────────────────────┐
│  📷                                 │
│  이미지를 드래그하여 업로드하거나   │
│  [ 파일 선택 ]                      │
│  PNG, JPG, WEBP (최대 5MB)          │
└─────────────────────────────────────┘
```

### **업로드 중:**

```
┌─────────────────────────────────────┐
│  ⏳ (회전)                          │
│  업로드 중...                       │
└─────────────────────────────────────┘
```

### **업로드 완료:**

```
┌─────────────────────────────────────┐
│  🖼️ [이미지 미리보기]        [❌]  │
└─────────────────────────────────────┘

또는 직접 URL 입력:
[https://...                         ]
```

---

## 🔧 **기술 스택**

### **아키텍처:**

```
프론트엔드 (React)
    ↓ FormData
서버 (Hono + Deno)
    ↓ Supabase SDK
Supabase Storage
    ↓ Public URL
프론트엔드 (자동 반영)
```

### **파일 경로 구조:**

```
make-8aea8ee5-page-images/
├── login-admin/
│   ├── step1_1234567890.png
│   ├── step2_1234567891.jpg
│   └── header_1234567892.webp
├── member-info/
│   ├── step1_1234567893.png
│   └── step2_1234567894.jpg
└── general/
    └── ...
```

**파일명 규칙:**
- Step 이미지: `step{N}_{timestamp}.{ext}`
- 헤더 이미지: `header_{timestamp}.{ext}`
- 타임스탬프로 중복 방지

---

## ✨ **주요 기능**

### **1. 드래그 앤 드롭**
- ✅ 시각적 피드백 (호버 효과)
- ✅ 파일 타입 검증
- ✅ 파일 크기 검증 (5MB)

### **2. 로컬 미리보기**
- ✅ 업로드 전 미리보기
- ✅ 업로드 후 자동 반영
- ✅ 이미지 삭제 버튼

### **3. 에러 처리**
- ✅ 파일 타입 에러 (이미지만 허용)
- ✅ 파일 크기 에러 (5MB 초과)
- ✅ 업로드 실패 에러
- ✅ 네트워크 에러

### **4. 자동 버킷 생성**
- ✅ 버킷이 없으면 자동 생성
- ✅ Public 접근 설정
- ✅ 에러 없는 첫 실행

---

## 🚀 **지금 바로 테스트!**

### **Step 1: 백오피스 접속**
```
https://dms-guide.figma.site/admin
```

### **Step 2: 페이지 편집**
```
페이지 편집 → "기관 대표 관리자 회원가입" → 편집
```

### **Step 3: Step 관리 탭**
```
Step 관리 → Step 1 → 이미지 영역
```

### **Step 4: 이미지 업로드**
```
방법 1: 파일을 드래그하여 업로드 영역에 Drop
방법 2: "파일 선택" 버튼 클릭하여 파일 선택
```

### **Step 5: 확인**
```
✅ 미리보기 표시
✅ URL 자동 입력
✅ "저장" 버튼 클릭 (Phase 2B에서 실제 저장)
```

---

## 📋 **지원 파일 형식**

| 형식 | 지원 여부 | 권장 |
|------|----------|------|
| **PNG** | ✅ | ⭐⭐⭐ |
| **JPG/JPEG** | ✅ | ⭐⭐⭐ |
| **WEBP** | ✅ | ⭐⭐ |
| **GIF** | ✅ | ⭐ |
| **SVG** | ❌ | - |
| **BMP** | ❌ | - |

**권장 설정:**
- 형식: PNG (투명 배경) 또는 JPG (일반)
- 크기: 5MB 이하
- 해상도: 1920px 너비 권장 (데스크톱 최적화)

---

## 🔐 **보안 설정**

### **파일 검증:**
```typescript
// 1. 파일 타입 검증
if (!file.type.startsWith("image/")) {
  return "이미지 파일만 업로드할 수 있습니다.";
}

// 2. 파일 크기 검증
if (file.size > 5 * 1024 * 1024) {
  return "파일 크기는 5MB 이하만 가능합니다.";
}
```

### **서버 측 검증:**
```typescript
// 3. 필수 필드 검증
if (!file || !pageId || !fileName) {
  return { error: "Missing required fields" };
}

// 4. Supabase Storage 권한 확인
// Service Role Key 사용 → 관리자 권한
```

---

## 🎯 **사용 시나리오**

### **시나리오 1: 새 Step 이미지 추가**
```
1. Step 추가 버튼 클릭
2. 제목/설명 입력
3. 이미지 드래그 앤 드롭
4. 자동 업로드
5. 저장
```

### **시나리오 2: 기존 이미지 교체**
```
1. Step 선택
2. 기존 이미지 우측 ❌ 클릭
3. 새 이미지 드래그 앤 드롭
4. 자동 업로드
5. 저장
```

### **시나리오 3: URL과 업로드 혼용**
```
1. Step 1: 이미지 업로드 (Supabase)
2. Step 2: Unsplash URL 입력
3. Step 3: Figma Asset 사용
→ 모두 정상 작동!
```

---

## ⚙️ **환경 설정 (이미 완료됨)**

### **Supabase 설정:**
✅ 프로젝트 생성
✅ Storage 버킷 자동 생성: `make-8aea8ee5-page-images`
✅ Public 접근 활성화
✅ 서버 API 엔드포인트: `/make-server-8aea8ee5/admin/upload-image`

### **환경 변수:**
✅ `SUPABASE_URL`
✅ `SUPABASE_SERVICE_ROLE_KEY`
✅ 프론트엔드는 `publicAnonKey` 사용

---

## 🐛 **문제 해결**

### **업로드 실패 시:**

#### **1. 네트워크 에러**
```
증상: "업로드 중 오류가 발생했습니다."
해결: 인터넷 연결 확인
```

#### **2. 파일 크기 초과**
```
증상: "파일 크기는 5MB 이하만 가능합니다."
해결: 이미지 압축 (TinyPNG, Squoosh 등)
```

#### **3. 파일 타입 에러**
```
증상: "이미지 파일만 업로드할 수 있습니다."
해결: PNG/JPG/WEBP 파일 사용
```

#### **4. 버킷 생성 실패**
```
증상: "Bucket creation error"
해결: Supabase 대시보드에서 수동 생성
```

---

## 📈 **성능 최적화**

### **이미지 최적화 팁:**

```
1. 적절한 해상도 사용
   - 최대: 1920px 너비
   - 최소: 800px 너비

2. 파일 크기 최적화
   - TinyPNG로 압축
   - WEBP 형식 권장 (작은 파일 크기)

3. 로딩 성능
   - 5MB 제한으로 빠른 로드
   - CDN 자동 적용 (Supabase Storage)
```

---

## 🎉 **완성!**

이제 다음 기능이 모두 작동합니다:

✅ **드래그 앤 드롭** - 직관적인 이미지 업로드
✅ **파일 선택 버튼** - 전통적인 방식 지원
✅ **URL 직접 입력** - 기존 방식 유지
✅ **미리보기** - 업로드 전/후 확인
✅ **자동 저장** - Supabase Storage
✅ **에러 처리** - 친절한 에러 메시지

---

## 💡 **추가 개선 아이디어**

### **Future Enhancements:**

1. **이미지 편집**
   - 크롭/리사이즈
   - 필터 적용
   - 회전/반전

2. **일괄 업로드**
   - 여러 이미지 동시 업로드
   - 진행 상황 바
   - 일괄 작업 취소

3. **이미지 라이브러리**
   - 업로드한 이미지 갤러리
   - 재사용 가능
   - 검색/필터

4. **자동 최적화**
   - 서버 측 리사이즈
   - 자동 WEBP 변환
   - 썸네일 생성

---

**지금 바로 테스트해보세요! 🚀**

```
https://dms-guide.figma.site/admin
→ 페이지 편집
→ Step 관리
→ 이미지 드래그 앤 드롭!
```
